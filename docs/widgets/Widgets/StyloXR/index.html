<!DOCTYPE html>
<html lang="en-us">
  <head>
    <link rel="icon" href="../../../favicon.ico">

    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Book Of Mormon Explorer VR</title>
    <meta name="description" content="">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="../colors.css">
    <link rel="stylesheet" href="TemplateData/style.css">
  </head>
  <body>
    <div id="unity-container">
      <div id="instructions" style="display: none;">
        <div id="instructions-text"> Welcome to Book of Mormon Explorer VR. 
          Please note that as this demo uses the latest web technologies, if you run into any issues, please try using Google Chrome or another Chromium based browser for the best experience. 
          <br><br>
          Instructions: Hover over points to see more information. Click and drag to rotate, and middle-mouse drag to pan.
        </div>
      </div>
      <div id="unity-canvas-container">
        <div id="unity-loading-bar">
          <div id="unity-logo"></div>
          <div id="unity-progress-bar-empty">
            <div id="unity-progress-bar-full"></div>
          </div>
        </div>
        <canvas id="unity-canvas" style="width: 100%; height: 100%;"></canvas>
      </div>
      <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <button id="enterar" value="Enter AR" disabled>AR</button>
        <div id="unity-webxr-link">Using <a href="https://github.com/De-Panther/unity-webxr-export" target="_blank" title="WebXR Export">WebXR Export</a></div>
        <div id="unity-build-title">Book Of Mormon Explorer VR</div>
        <button id="play" class="button" value="Play" enabled><img src="TemplateData/play.svg" class="icons"></img></button>
        <audio id="audio" src="TemplateData/switch_007.ogg"></audio>
        
        <button id="pause" class="button" value="Pause" enabled><img src="TemplateData/pause.svg" class="icons"></img></button>
        <button id="stop" class="button" value="Stop" enabled><img src="TemplateData/stop.svg" class="icons"></img></button>
        <button id="rewind" class="button" value="Rewind" enabled><img src="TemplateData/back10s.svg" class="icons"></img></button>
        <button id="reset" class="button" value="Reset" enabled>Reset Camera</button>
        <button id="entervr" class="button" value="Enter VR" disabled>Enter VR</button>
      </div>
    </div>
    <script>
      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/dev.loader.js";
      var config = {
        dataUrl: buildUrl + "/dev.data",
        frameworkUrl: buildUrl + "/dev.framework.js",
        codeUrl: buildUrl + "/dev.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "LTAC",
        productName: "Book Of Mormon Explorer VR",
        productVersion: "0.2",
      };

      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var canvasContainer = document.querySelector("#unity-canvas-container");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");
      var unityInstance = null;
      

      canvasContainer.style.width = "100%";
      canvasContainer.style.height = "100%";
      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        }).then((instance) => {
          unityInstance = instance;
          loadingBar.style.display = "none";
          if (fullscreenButton)
          {
            fullscreenButton.onclick = () => {
              unityInstance.SetFullscreen(1);
            };
          }
        }).catch((message) => {
          alert(message);
        });
      };
      document.body.appendChild(script);

      let playAudio = document.getElementById('audio');
      let enterARButton = document.getElementById('enterar');
      let enterVRButton = document.getElementById('entervr');
      let enterPlayButton = document.getElementById('play');
      let enterPauseButton = document.getElementById('pause');
      let enterStopButton = document.getElementById('stop');
      let enterRewindButton = document.getElementById('rewind');
      let enterResetButton = document.getElementById('reset');

      document.addEventListener('onARSupportedCheck', function (event) {
        enterARButton.disabled = !event.detail.supported;
      }, false);
      document.addEventListener('onVRSupportedCheck', function (event) {
        enterVRButton.disabled = !event.detail.supported;
      }, false);

      enterARButton.addEventListener('click', function (event) {
        unityInstance.Module.WebXR.toggleAR();
      }, false);
      enterVRButton.addEventListener('click', function (event) {
        unityInstance.Module.WebXR.toggleVR();
      }, false);
      enterPlayButton.addEventListener('click', function (event) {
        unityInstance.SendMessage('Animation Player', 'Play');
        playAudio.play();
      }, false);
      enterPauseButton.addEventListener('click', function (event) {
        unityInstance.SendMessage('Animation Player', 'Pause');
      }, false);
      enterStopButton.addEventListener('click', function (event) {
        unityInstance.SendMessage('Animation Player', 'Stop');
      }, false);
      enterRewindButton.addEventListener('click', function (event) {
        unityInstance.SendMessage('Animation Player', 'RewindBySeconds', 10);
      }, false);
      enterResetButton.addEventListener('click', function (event) {
        unityInstance.SendMessage('Camera Controller', 'ResetCamera');
      }, false);
    </script>
  </body>
</html>
